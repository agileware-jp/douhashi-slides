name: inverse
layout: true
class: underscore

---
class: center, middle, hero

# 乱立してるRedmineを一つにまとめる話

@douhashi

---
# 自己紹介

---
# アンケート

## 社内にRedmineは複数ある or ない?

---
class: center, middle
# ある日、こんな依頼が...

---
class: center, middle
## 複数あるRedmineを統合したい

---
# 統合したい理由

1. 現在 **20台** 以上のRedmineが乱立していて運用もバラバラ
2. すべてのインスタンスが1台のサーバに同居しているのでパフォーマンスの問題もでているので解消したい

---
class: center, middle

## わかった。じゃあ統合しよう。
### (結構カジュアルに決断)

---
class: center, middle

# ここから苦労話スタート。

---
# Redmine側の課題 1

## Redmineって...

### **チケット番号 = DBのID**なんだよね...

---
# チケット番号 = ID問題

1. DB上のauto incrementなid列をチケット番号に使用している
2. コミットコメントやチケット等で「#100」などチケット番号で参照している

=> **つまり、単純にCSV出力/インポートでは参照が崩れる!**

---
# Redmine側の課題 2

### 単純に統合しちゃうと、トラッカーとかステータス大爆発しちゃうよね

### 出来る限りはまとめたい、よねー。

---
class: center, middle
# 解決策

---
class: center, middle
## 賢いRedmine統合ツール作った

(弊社の優秀なエンジニアが...!)

---
# こんな感じ

1. 統合元Redmineのデータを **中間データ(SQLite)** として出力する
    * 統合前のIDを中間データに保存しておく(from ID)
2. 統合先へインポート
    * 統合後のIDを保存しておく(to ID)
3. from idを元に、チケット/Wiki/コミットコメント等の参照を張り替える

---
# こんなことも出来る

1. 統合元Redmineのトラッカーやカテゴリ等を統合先の既存データに合わせる
    * 設定ファイルで定義できるようにした
2. 添付ファイルをごっそり移行する

---
class: center, middle
# 賢いツールができたので

## いざ、統合テスト!!

---
class: center, middle
# ここで問題発生

---
class: center, middle
# むっちゃ遅い!!!

---
class: 
